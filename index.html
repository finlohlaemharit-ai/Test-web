<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô AI Content Bootcamp</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    body { font-family: "Prompt", sans-serif; background: #F0F6FF; color: #003B8E; margin: 0; padding-bottom: 40px; }
    .container { max-width: 550px; margin: auto; padding: 20px; box-sizing: border-box; }
    
    .search-card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-left: 6px solid #0072FF; }
    .search-title { font-size: 18px; font-weight: 700; color: #003B8E; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
    .search-box-wrapper { display: flex; gap: 10px; }
    .search-input { flex: 1; padding: 12px 15px; border: 1px solid #E1E8F5; border-radius: 8px; font-family: "Prompt"; font-size: 14px; outline: none; }
    .search-input:focus { border-color: #0072FF; }
    .search-btn { background: #0072FF; color: white; border: none; padding: 0 20px; border-radius: 8px; font-family: "Prompt"; font-weight: 600; cursor: pointer; white-space: nowrap; }
    
    .banner { width: 100%; border-radius: 16px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,59,142,0.2); background: linear-gradient(135deg, #00C6FF, #0072FF); color: white; text-align: center; padding: 40px 20px; box-sizing: border-box; }
    .banner h1 { margin: 0; font-size: 26px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.1); line-height: 1.3; }
    .banner p { margin: 8px 0 0; opacity: 0.95; font-size: 15px; font-weight: 300; }
    .logo-badge { background: rgba(255,255,255,0.25); padding: 6px 14px; border-radius: 20px; font-size: 13px; margin-bottom: 12px; display: inline-block; backdrop-filter: blur(5px); }
    
    .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.04); margin-bottom: 20px; }
    .section-title { font-size: 18px; font-weight: 700; margin: 30px 0 12px; padding-left: 10px; border-left: 5px solid #00C6FF; line-height: 1; color: #003B8E; }
    .tech-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 25px; }
    .tech-badge { background: white; border: 1px solid #E6F7FF; color: #0072FF; padding: 8px 14px; border-radius: 50px; font-size: 13px; font-weight: 500; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
    
    .agenda-toggle-btn { background: white; color: #003B8E; width: 100%; padding: 15px 20px; border: none; border-radius: 12px; font-family: "Prompt", sans-serif; font-size: 16px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 25px; }
    .agenda-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; background: white; border-radius: 0 0 12px 12px; margin-top: -30px; margin-bottom: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .agenda-content.show { max-height: 500px; margin-top: -20px; }
    .agenda-list { padding: 20px; list-style: none; margin: 0; }
    .agenda-list li { margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px dashed #eee; font-size: 14px; display: flex; align-items: flex-start; }
    .day-badge { background: #E6F7FF; color: #0072FF; font-weight: 700; padding: 2px 8px; border-radius: 6px; margin-right: 10px; font-size: 12px; min-width: 45px; text-align: center; }
    
    /* --- NEW STATS STYLE (Refer to Image) --- */
    .stats-row { margin-bottom: 20px; }
    .stats-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 14px; color: #333; }
    .stats-name { font-weight: 500; color: #333; }
    .stats-value { font-weight: 500; color: #555; }
    
    .progress-bg { background: #E1E8F5; height: 10px; border-radius: 20px; overflow: hidden; width: 100%; }
    /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏™‡∏î‡πÉ‡∏™‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö */
    .progress-fill { background: #0099FF; height: 100%; width: 0%; transition: width 1s ease; border-radius: 20px; }
    
    /* Highlight Max Value (Red color) */
    .stat-max-text { color: #FF0000 !important; font-weight: 800 !important; }
    
    .total-container { 
        background: #F8F9FA; border-radius: 12px; padding: 15px; text-align: center; margin-top: 25px; 
        display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 14px; color: #666;
    }
    .total-number { color: #003B8E; font-size: 28px; font-weight: 800; line-height: 1; }

    .choice-group { display: flex; flex-direction: column; gap: 12px; }
    .choice-btn { border: 2px solid #E1E8F5; padding: 18px; border-radius: 14px; background: white; cursor: pointer; text-align: left; transition: all 0.2s; position: relative; }
    .choice-btn:hover { border-color: #00C6FF; }
    .choice-btn.active { border-color: #0072FF; background: #F0F9FF; box-shadow: 0 4px 12px rgba(0,114,255,0.15); }
    .choice-btn.active::after { content: '\f00c'; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: #0072FF; font-size: 18px; }
    .choice-title { font-weight: 700; font-size: 16px; display: block; color: #003B8E; margin-bottom: 4px; }
    .choice-desc { font-size: 13px; color: #666; font-weight: 400; }
    
    .form-group { margin-bottom: 18px; }
    .input-label { display: block; margin-bottom: 8px; font-size: 15px; font-weight: 600; color: #003B8E; }
    .required { color: #FF4D4F; margin-left: 4px; font-size: 16px; }
    input, select { width: 100%; padding: 16px; border: 1px solid #E1E8F5; border-radius: 12px; font-size: 16px; font-family: "Prompt"; background: #FAFCFF; box-sizing: border-box; outline: none; transition: 0.3s; color: #333; }
    
    .submit-btn { width: 100%; background: linear-gradient(90deg, #0066FF, #00CCFF); color: white; border: none; padding: 18px; font-size: 20px; font-weight: 700; border-radius: 50px; cursor: pointer; box-shadow: 0 10px 30px rgba(0, 114, 255, 0.4); margin-top: 20px; transition: all 0.3s ease; display: flex; justify-content: center; align-items: center; gap: 10px; }
    .submit-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(0, 114, 255, 0.5); }
    .submit-btn:active { transform: scale(0.98) translateY(0); }
    
    .tier-container { background: #fff; border: 1px solid #E1E8F5; border-radius: 16px; overflow: hidden; margin-bottom: 25px; text-align: left; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
    .tier-item { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; font-size: 15px; color: #888; position: relative; }
    .tier-item.active { background: #E6F7FF; color: #003B8E; font-weight: 700; border-left: 6px solid #0072FF; }
    .tier-item.sold-out { background: #fcfcfc; color: #ccc; }
    .tier-item.sold-out span:first-child { text-decoration: line-through; }
    .badge-stock { background: linear-gradient(135deg, #FF4D4F, #FF7875); color: white; font-size: 12px; padding: 4px 10px; border-radius: 20px; margin-left: 8px; font-weight: 600; display: inline-block; vertical-align: middle; animation: pulse 2s infinite; }
    .badge-sold { background: #999; color: white; font-size: 11px; padding: 3px 8px; border-radius: 4px; margin-left: 8px; display: inline-block; font-weight: 500; }
    
    .price-box { background: linear-gradient(135deg, #00C6FF, #0072FF); color: white; padding: 25px 20px; border-radius: 16px; margin-bottom: 25px; margin-top: 15px; box-shadow: 0 8px 20px rgba(0,114,255,0.25); text-align: center; }
    .price-val { font-size: 48px; font-weight: 800; line-height: 1; }
    .qr-frame { border: 3px solid #E1E8F5; border-radius: 20px; padding: 15px; display: inline-block; margin-bottom: 20px; background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align: center; }
    .qr-img { width: 100%; max-width: 260px; border-radius: 12px; display: block; }
    .upload-btn-wrapper { position: relative; overflow: hidden; display: inline-block; width: 100%; margin-top: 15px; }
    .btn-select { border: 2px dashed #0072FF; color: #0072FF; background-color: #F0F9FF; padding: 15px 20px; border-radius: 12px; font-weight: 600; width: 100%; cursor: pointer; transition: 0.2s; font-size: 16px; }
    .upload-btn-wrapper input[type=file] { font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer; height: 100%; width: 100%; }
    #preview { margin-top: 20px; max-width: 100%; border-radius: 12px; display: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid #eee; }
      
    .line-btn { display: block; width: 100%; text-decoration: none; padding: 15px 0; border-radius: 50px; font-weight: bold; margin-bottom: 10px; transition: transform 0.2s; cursor: pointer; text-align: center; }
    .btn-main { background: #06C755; color: white; box-shadow: 0 4px 15px rgba(6,199,85,0.3); }
    .btn-sec { background: white; color: #003B8E; border: 2px solid #003B8E; }
    .hidden { display: none !important; }
    #loading { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); z-index:999; flex-direction:column; justify-content:center; align-items:center; }
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #0072FF; border-radius: 50%; width: 45px; height: 45px; animation: spin 0.8s linear infinite; margin-bottom: 20px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Custom Modal */
    #custom-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
    .custom-modal { background: white; width: 90%; max-width: 400px; padding: 30px 25px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: popIn 0.3s ease; }
    @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    .modal-icon { font-size: 50px; margin-bottom: 15px; }
    .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 10px; color: #003B8E; }
    .modal-desc { font-size: 15px; color: #555; margin-bottom: 25px; line-height: 1.5; }
    .modal-actions { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
    .modal-btn { flex: 1; padding: 12px; border-radius: 50px; font-weight: bold; cursor: pointer; border: none; font-size: 15px; min-width: 120px; }
    .btn-confirm { background: #0072FF; color: white; }
    .btn-cancel { background: #f0f0f0; color: #333; }
    .btn-line { background: #06C755; color: white; width: 100%; display: block; text-decoration: none; padding: 12px; box-sizing: border-box; }
    
    .pay-choice-btn { display: block; width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 12px; border: 2px solid #E1E8F5; background: white; text-align: left; cursor: pointer; transition: 0.2s; }
    .pay-choice-btn:hover { border-color: #0072FF; background: #F0F9FF; }
    .pay-choice-title { font-weight: 700; color: #003B8E; font-size: 16px; display: block; }
    .pay-choice-desc { font-size: 13px; color: #666; }
    .pay-choice-badge { float: right; background: #E6F7FF; color: #0072FF; font-size: 12px; padding: 2px 8px; border-radius: 4px; font-weight: bold; }

    /* Checkmark */
    .checkmark-wrapper { width: 100px; height: 100px; margin: 0 auto 20px; }
    .checkmark-svg { width: 100px; height: 100px; display: block; }
    .checkmark-circle { stroke-dasharray: 166; stroke-dashoffset: 166; stroke-width: 2; stroke-miterlimit: 10; stroke: #06C755; fill: none; stroke-linecap: round; animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards; }
    .checkmark-fill { fill: #06C755; transform-origin: center; transform: scale(0); animation: fillScale 0.4s ease-in-out 0.4s forwards; }
    .checkmark-check { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; stroke: #ffffff; stroke-width: 4; stroke-linecap: round; animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards; }
    @keyframes stroke { 100% { stroke-dashoffset: 0; } }
    @keyframes fillScale { to { transform: scale(1); } }
  </style>
</head>
<body>

  <!-- Loading Screen -->
  <div id="loading"><div class="spinner"></div><div style="font-weight: 600; color: #003B8E;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</div></div>

  <!-- Custom Modal -->
  <div id="custom-modal-overlay">
    <div class="custom-modal">
      <div id="modal-icon" class="modal-icon"></div>
      <div id="modal-title" class="modal-title"></div>
      <div id="modal-desc" class="modal-desc"></div>
      <div id="modal-content-extra"></div>
      <div id="modal-actions" class="modal-actions"></div>
    </div>
  </div>

  <!-- STEP 1: REGISTRATION -->
  <div id="step-register" class="container">
    <div class="search-card">
        <div class="search-title"><i class="fas fa-search"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ / ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°</div>
        <div class="search-box-wrapper">
            <input type="tel" id="search-phone" class="search-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£" maxlength="10">
            <button class="search-btn" onclick="checkStatus()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>
    </div>

    <div class="banner">
      <div class="logo-badge">Chokdee Content</div>
      <h1>AI Content Bootcamp</h1>
      <p>(5 Days) ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå + ‡πÉ‡∏ä‡πâ AI ‡∏à‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ó‡∏≥</p>
    </div>

    <div class="tech-grid">
      <div class="tech-badge">Canva</div><div class="tech-badge">Keynote</div><div class="tech-badge">CapCut</div>
      <div class="tech-badge">Numbers</div><div class="tech-badge">ChatGPT</div><div class="tech-badge">Gemini</div>
      <div class="tech-badge">Facebook</div><div class="tech-badge">Digital Office</div><div class="tech-badge">LINE OA</div>
    </div>

    <button class="agenda-toggle-btn" onclick="toggleAgenda()"><span>‚≠êÔ∏è AGENDA ‡∏™‡∏£‡∏∏‡∏õ 5 ‡∏ß‡∏±‡∏ô</span><i class="fas fa-chevron-down" id="agenda-icon"></i></button>
    <div class="agenda-content" id="agenda-box">
      <ul class="agenda-list">
        <li><span class="day-badge">Day 1</span><span><b>Canva / Keynote</b> ‚Äì ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå + ‡∏ó‡∏≥‡∏†‡∏≤‡∏û</span></li>
        <li><span class="day-badge">Day 2</span><span><b>CapCut / Numbers</b> ‚Äì ‡∏ó‡∏≥‡∏Ñ‡∏•‡∏¥‡∏õ + ‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏≤‡∏ô + ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡∏≤‡∏¢</span></li>
        <li><span class="day-badge">Day 3</span><span><b>ChatGPT / Gemini</b> ‚Äì AI Content</span></li>
        <li><span class="day-badge">Day 4</span><span><b>Facebook / Digital Office</b> ‚Äì ‡∏•‡∏á‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ó‡∏ô‡∏ï‡πå‡∏à‡∏£‡∏¥‡∏á</span></li>
        <li><span class="day-badge">Day 5</span><span><b>LINE OA</b> ‚Äì Broadcast + Rich Menu + ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span></li>
      </ul>
    </div>

    <div class="card">
      <div class="section-title" style="margin-top:0;">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Real-time)</div>
      
      <!-- UPDATED UI Structure -->
      <div class="stats-row">
        <div class="stats-header">
            <span class="stats-name" id="lbl-stat-day-a">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
            <span class="stats-value" id="txt-dayA"><i class="fas fa-circle-notch fa-spin"></i></span>
        </div>
        <div class="progress-bg"><div class="progress-fill" id="bar-dayA"></div></div>
      </div>

      <div class="stats-row">
        <div class="stats-header">
            <span class="stats-name" id="lbl-stat-day-b">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
            <span class="stats-value" id="txt-dayB"><i class="fas fa-circle-notch fa-spin"></i></span>
        </div>
        <div class="progress-bg"><div class="progress-fill" id="bar-dayB"></div></div>
      </div>

      <div style="margin: 20px 0; border-top: 1px dashed #E1E8F5;"></div>

      <div class="stats-row">
        <div class="stats-header">
            <span class="stats-name" id="lbl-stat-time-1">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
            <span class="stats-value" id="txt-time1"><i class="fas fa-circle-notch fa-spin"></i></span>
        </div>
        <div class="progress-bg"><div class="progress-fill" id="bar-time1"></div></div>
      </div>

      <div class="stats-row">
        <div class="stats-header">
            <span class="stats-name" id="lbl-stat-time-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
            <span class="stats-value" id="txt-time2"><i class="fas fa-circle-notch fa-spin"></i></span>
        </div>
        <div class="progress-bg"><div class="progress-fill" id="bar-time2"></div></div>
      </div>
      
      <div class="total-container">
        <span>‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
        <b class="total-number" id="total-reg"><i class="fas fa-circle-notch fa-spin" style="font-size: 20px;"></i></b>
        <span>‡∏ó‡πà‡∏≤‡∏ô</span>
      </div>
      <div style="text-align: center; color: #FF0000; font-weight: 500; font-size: 12px; margin-top: 10px;">*‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
    </div>

    <div class="section-title" id="section-day">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="required">*</span></div>
    <div class="choice-group" style="margin-bottom: 20px;">
      <div class="choice-btn" onclick="selectDay('A', this)"><span class="choice-title" id="ui-day-a">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span><span class="choice-desc">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span></div>
      <div class="choice-btn" onclick="selectDay('B', this)"><span class="choice-title" id="ui-day-b">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span><span class="choice-desc">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span></div>
    </div>

    <div class="section-title" id="section-time">‚è∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <span class="required">*</span></div>
    <div class="choice-group">
      <div class="choice-btn" onclick="selectTime('1', this)"><span class="choice-title" id="ui-time-1">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span><span class="choice-desc">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</span></div>
      <div class="choice-btn" onclick="selectTime('2', this)"><span class="choice-title" id="ui-time-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span><span class="choice-desc">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 2 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</span></div>
    </div>

    <div class="section-title">üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>
    <div class="card">
      <div class="form-group"><label class="input-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (10 ‡∏´‡∏•‡∏±‡∏Å) <span class="required">*</span></label><input type="tel" id="phone" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" maxlength="10" inputmode="numeric" oninput="this.value = this.value.replace(/[^0-9]/g, '')"></div>
      <div class="form-group"><label class="input-label">‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required">*</span></label><input type="text" id="fullname" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"></div>
      <div class="form-group"><label class="input-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• <span class="required">*</span></label><input type="email" id="email" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: name@example.com"></div>
      <div class="form-group"><label class="input-label">LINE ID <span class="required">*</span></label><input type="text" id="lineid" placeholder="‡∏Å‡∏£‡∏≠‡∏Å LINE ID"></div>
      <div class="form-group"><label class="input-label">‡∏™‡∏≤‡∏Ç‡∏≤ <span class="required">*</span></label><input type="text" id="branch" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏≤‡∏Ç‡∏≤"></div>
      <div class="form-group"><label class="input-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <span class="required">*</span></label>
        <select id="position" onchange="toggleOtherPosition()">
          <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á --</option>
          <option>‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô</option><option>‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏´‡∏ô‡πà‡∏ß‡∏¢</option><option>‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏®‡∏π‡∏ô‡∏¢‡πå</option><option>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏®‡∏π‡∏ô‡∏¢‡πå</option>
          <option>‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏†‡∏≤‡∏Ñ</option><option>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏Ñ</option><option>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏Ñ‡∏≠‡∏≤‡∏ß‡∏∏‡πÇ‡∏™</option><option>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ù‡πà‡∏≤‡∏¢</option><option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
        </select>
      </div>
      <div class="form-group" id="other-position-group" style="display: none;">
        <label class="input-label">‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <span class="required">*</span></label><input type="text" id="other_position" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
      </div>
    </div>

    <button class="submit-btn" onclick="submitForm()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ <i class="fas fa-arrow-right"></i></button>
  </div>

  <!-- STEP 2: PAYMENT -->
  <div id="step-payment" class="container hidden">
    <h3 style="margin-top:0; color:#003B8E; font-size: 22px; text-align:center;">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏£‡πå‡∏™</h3>
    <div class="tier-container" id="pricing-tiers">
      <div class="tier-item" id="tier-super"><span>Super Early Bird</span><span id="price-super">...</span></div>
      <div class="tier-item" id="tier-early"><span>Early Bird</span><span id="price-early">...</span></div>
      <div class="tier-item" id="tier-normal"><span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥</span><span id="price-normal">...</span></div>
    </div>
    <div class="price-box">
      <div class="price-label" id="pay-label">‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</div>
      <div><span class="price-val" id="showPrice">...</span><span class="price-unit">‡∏ö‡∏≤‡∏ó</span></div>
    </div>
    <div style="text-align: center;">
      <div class="qr-frame">
        <img src="https://lh5.googleusercontent.com/d/1XTK-hRKadNaPH5HUqgROer_xbuehWIT1" class="qr-img" id="qrImage">
        <p style="font-size: 13px; margin: 10px 0 0; color:#555; font-weight: 500;"><i class="fas fa-university"></i> ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢<br><span style="color:#003B8E; font-weight:bold;">726-2-87971-7</span></p>
      </div>
    </div>
    <div style="text-align: left; margin-top: 15px;">
      <label style="font-weight: bold; font-size:15px; margin-left:5px; color:#333;">‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
      <div class="upload-btn-wrapper">
        <button class="btn-select" id="btnSelect"><i class="fas fa-cloud-upload-alt"></i> ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ</button>
        <input type="file" id="slipFile" accept="image/*" onchange="previewFile()">
      </div>
      <img id="preview">
    </div>
    <button class="submit-btn" id="btnConfirm" onclick="uploadSlip()"><i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
  </div>

  <!-- STEP 3: SUCCESS -->
  <div id="step-success" class="container hidden" style="text-align: center; padding-top: 40px;">
    <div class="checkmark-wrapper">
      <svg class="checkmark-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
        <circle class="checkmark-fill" cx="26" cy="26" r="23" /><circle class="checkmark-circle" cx="26" cy="26" r="23" fill="none"/>
        <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
      </svg>
    </div>
    <h2 style="color:#003B8E; margin-bottom:10px;">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
    <p style="color:#666; font-size:14px; margin-bottom:30px;" id="success-msg">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
    <a href="https://line.me/ti/g/fmMXxuHaw-" class="line-btn btn-main" target="_blank" id="btn-line-group">‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÑ‡∏•‡∏ô‡πå (Click)</a>
    <a href="#" onclick="location.reload()" class="line-btn btn-sec">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
  </div>

  <script>
    // ‚ö†Ô∏è ‡∏ô‡∏≥ URL ‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy ‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzP1UnidfntqYcGtg96EI_2KDr7a4ziXEQcL1xwd7-QZ7weVbPpZPgZFRDilQmqtk80/exec";

    let selectedData = { day: "", time: "" };
    let globalRowID = null;
    let globalFullPrice = 0;
    let globalConfig = null;
    let currentPaymentType = 'full';

    window.onload = function() {
      fetch(WEB_APP_URL + "?action=getStats")
        .then(res => res.json())
        .then(renderStats).catch(err => console.warn(err));
      fetch(WEB_APP_URL + "?action=getConfig")
        .then(res => res.json())
        .then(data => { 
            globalConfig = data; 
            renderConfig(data.config); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô UI ‡∏ï‡∏≤‡∏° Config
            updatePricingUI(data); 
        }).catch(err => console.warn(err));
    };

    function renderConfig(cfg) {
        if(!cfg) return;
        // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô
        document.getElementById('ui-day-a').innerText = "A) " + cfg.labelDayA;
        document.getElementById('ui-day-b').innerText = "B) " + cfg.labelDayB;
        // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
        document.getElementById('ui-time-1').innerText = "‚è∞ " + cfg.labelTime1;
        document.getElementById('ui-time-2').innerText = "‚è∞ " + cfg.labelTime2;
        // ‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        document.getElementById('lbl-stat-day-a').innerText = cfg.labelDayA;
        document.getElementById('lbl-stat-day-b').innerText = cfg.labelDayB;
        document.getElementById('lbl-stat-time-1').innerText = cfg.labelTime1;
        document.getElementById('lbl-stat-time-2').innerText = cfg.labelTime2;
    }

    function showStep(stepId) {
      document.getElementById('step-register').classList.add('hidden');
      document.getElementById('step-payment').classList.add('hidden');
      document.getElementById('step-success').classList.add('hidden');
      document.getElementById(stepId).classList.remove('hidden');
      window.scrollTo(0, 0);
    }

    function selectDay(val, el) {
      if(!globalConfig) return alert("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà");
      const realValue = val === 'A' ? globalConfig.config.labelDayA : globalConfig.config.labelDayB;
      const group = el.closest('.choice-group');
      if (el.classList.contains('active')) { selectedData.day = ""; el.classList.remove('active'); } 
      else { group.querySelectorAll('.choice-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); selectedData.day = realValue; }
    }

    function selectTime(val, el) {
      if(!globalConfig) return alert("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà");
      const realValue = val === '1' ? globalConfig.config.labelTime1 : globalConfig.config.labelTime2;
      const group = el.closest('.choice-group');
      if (el.classList.contains('active')) { selectedData.time = ""; el.classList.remove('active'); } 
      else { group.querySelectorAll('.choice-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); selectedData.time = realValue; }
    }

    function toggleAgenda() {
      const box = document.getElementById('agenda-box');
      const icon = document.getElementById('agenda-icon');
      if (box.classList.contains('show')) { box.classList.remove('show'); icon.classList.remove('fa-chevron-down'); icon.classList.add('fa-chevron-down'); }
      else { box.classList.add('show'); icon.classList.remove('fa-chevron-down'); icon.classList.add('fa-chevron-up'); }
    }
    function toggleOtherPosition() {
        const pos = document.getElementById('position').value;
        const otherGroup = document.getElementById('other-position-group');
        otherGroup.style.display = (pos === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') ? 'block' : 'none';
        if(pos !== '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') document.getElementById('other_position').value = '';
    }

    function renderStats(stats) {
      if (!stats) return;
      document.getElementById("total-reg").innerText = stats.total;
      
      // Calculate max percentages to highlight the winner
      const maxDayVal = Math.max(stats.dayA, stats.dayB);
      const maxTimeVal = Math.max(stats.time1, stats.time2);

      updateBar("bar-dayA", "txt-dayA", stats.dayA, stats.total, maxDayVal > 0 && stats.dayA === maxDayVal);
      updateBar("bar-dayB", "txt-dayB", stats.dayB, stats.total, maxDayVal > 0 && stats.dayB === maxDayVal);
      updateBar("bar-time1", "txt-time1", stats.time1, stats.total, maxTimeVal > 0 && stats.time1 === maxTimeVal);
      updateBar("bar-time2", "txt-time2", stats.time2, stats.total, maxTimeVal > 0 && stats.time2 === maxTimeVal);
    }

    function updateBar(barId, txtId, val, total, isMax) {
      let pct = total === 0 ? 0 : Math.round((val / total) * 100);
      document.getElementById(barId).style.width = pct + "%";
      
      const txtEl = document.getElementById(txtId);
      txtEl.innerText = pct + "% (" + val + " ‡∏Ñ‡∏ô)";
      
      if(isMax) txtEl.classList.add('stat-max-text');
      else txtEl.classList.remove('stat-max-text');
    }

    function showModal(type, callback, extraData = null) {
        const overlay = document.getElementById('custom-modal-overlay');
        const icon = document.getElementById('modal-icon');
        const title = document.getElementById('modal-title');
        const desc = document.getElementById('modal-desc');
        const contentExtra = document.getElementById('modal-content-extra');
        const actions = document.getElementById('modal-actions');

        overlay.style.display = 'flex';
        actions.innerHTML = ''; contentExtra.innerHTML = ''; icon.innerHTML = '';

        if (type === 'payment_choice') {
            icon.innerHTML = 'üí≥'; title.innerText = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô';
            desc.innerHTML = '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≠‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡πà‡∏≠‡∏ô (20%) <br>‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (100%)';
            const fullPrice = extraData.price;
            const depositPrice = Math.ceil(fullPrice * 0.2);
            contentExtra.innerHTML = `
                <div class="pay-choice-btn" onclick="selectPaymentType('deposit', ${depositPrice}, ${fullPrice})"><span class="pay-choice-title">‡∏à‡∏≠‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏°‡∏±‡∏î‡∏à‡∏≥ 20%) <span class="pay-choice-badge">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span></span><span class="pay-choice-desc">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏û‡∏µ‡∏¢‡∏á <b>${depositPrice.toLocaleString()}</b> ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡πá‡∏≠‡∏Ñ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á</span></div>
                <div class="pay-choice-btn" onclick="selectPaymentType('full', ${fullPrice}, ${fullPrice})"><span class="pay-choice-title">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (100%)</span><span class="pay-choice-desc">‡∏ä‡∏≥‡∏£‡∏∞‡∏¢‡∏≠‡∏î <b>${fullPrice.toLocaleString()}</b> ‡∏ö‡∏≤‡∏ó</span></div>`;
            const btnCancel = document.createElement('button'); btnCancel.className = 'modal-btn btn-cancel'; btnCancel.innerText = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'; btnCancel.onclick = function() { overlay.style.display = 'none'; }; actions.appendChild(btnCancel);
        } else if (type === 'duplicate_pending') {
            icon.innerHTML = '‚ö†Ô∏è'; title.innerText = '‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö'; desc.innerHTML = '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ô‡∏µ‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô<br>‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?';
            const btnConfirm = document.createElement('button'); btnConfirm.className = 'modal-btn btn-confirm'; btnConfirm.innerText = '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠'; btnConfirm.onclick = function() { overlay.style.display = 'none'; callback(true); };
            const btnCancel = document.createElement('button'); btnCancel.className = 'modal-btn btn-cancel'; btnCancel.innerText = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'; btnCancel.onclick = function() { overlay.style.display = 'none'; callback(false); location.reload(); };
            actions.appendChild(btnCancel); actions.appendChild(btnConfirm);
        } else if (type === 'duplicate_paid') {
            icon.innerHTML = '‚úÖ'; title.innerText = '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß'; desc.innerHTML = '‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ';
            const btnLine = document.createElement('a'); btnLine.className = 'modal-btn btn-line'; btnLine.innerText = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÑ‡∏•‡∏ô‡πå'; btnLine.href = 'https://line.me/ti/g/fmMXxuHaw-'; btnLine.target = '_blank'; actions.appendChild(btnLine);
        } else if (type === 'not_found') {
            icon.innerHTML = '‚ùå'; title.innerText = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'; desc.innerHTML = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏≤‡∏à‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
            const btnOk = document.createElement('button'); btnOk.className = 'modal-btn btn-cancel'; btnOk.innerText = '‡∏õ‡∏¥‡∏î'; btnOk.onclick = function() { overlay.style.display = 'none'; }; actions.appendChild(btnOk);
        }
    }

    function checkStatus() {
        const phone = document.getElementById('search-phone').value.trim();
        if (!phone || phone.length < 9) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        document.getElementById('loading').style.display = 'flex';
        fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify({ action: 'checkStatus', phone: phone }) })
        .then(res => res.json()).then(res => {
            document.getElementById('loading').style.display = 'none';
            if (res.status === "found") {
                const d = res.data; globalRowID = d.rowid; globalFullPrice = d.fullPrice;
                if (d.rowStatus === "Paid") showModal('duplicate_paid');
                else if (d.rowStatus === "Booking") {
                    currentPaymentType = 'remaining'; setupPaymentPage(d.remaining); showStep('step-payment');
                    document.getElementById('pay-label').innerHTML = "‡∏ä‡∏≥‡∏£‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (80%)";
                    alert(`‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ${d.fullname}\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${d.remaining} ‡∏ö‡∏≤‡∏ó`);
                } else if (d.rowStatus === "Pending") showModal('payment_choice', null, { price: d.fullPrice });
            } else showModal('not_found');
        }).catch(() => { document.getElementById('loading').style.display = 'none'; alert("Connection Error"); });
    }

    function selectPaymentType(type, amount, fullPrice) {
        currentPaymentType = type; globalFullPrice = fullPrice;
        document.getElementById('custom-modal-overlay').style.display = 'none';
        setupPaymentPage(amount);
        document.getElementById('pay-label').innerHTML = type === 'deposit' ? "‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏°‡∏±‡∏î‡∏à‡∏≥ (20%)" : "‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞ (‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô)";
        showStep('step-payment');
    }

    function submitForm(isForceUpdate = false) {
      const phoneInput = document.getElementById('phone').value.trim();
      let positionValue = document.getElementById('position').value;
      if (positionValue === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') positionValue = document.getElementById('other_position').value.trim();

      const form = {
        fullname: document.getElementById('fullname').value.trim(),
        phone: phoneInput,
        email: document.getElementById('email').value.trim(),
        lineid: document.getElementById('lineid').value.trim(),
        branch: document.getElementById('branch').value.trim(),
        position: positionValue,
        day: selectedData.day,
        time: selectedData.time
      };
      if(!form.day) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'");
      if(!form.time) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'");
      if(!form.phone || form.phone.length !== 10) return alert("‚ö†Ô∏è ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 10 ‡∏´‡∏•‡∏±‡∏Å");
      if(!form.fullname || !form.email || !form.lineid || !form.branch || !positionValue) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

      document.getElementById('loading').style.display = 'flex';
      fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify({ action: 'register', form: form, forceUpdate: isForceUpdate, paymentType: 'pending_choice' }) })
      .then(res => res.json()).then(res => {
        document.getElementById('loading').style.display = 'none';
        if (res.status === "EXISTING_FOUND") showModal('duplicate_pending', function(c) { if(c) submitForm(true); });
        else if (res.status === "ALREADY_PAID") showModal('duplicate_paid');
        else if (res.rowid) {
            globalRowID = res.rowid; globalFullPrice = res.price;
            if (res.rowStatus === "Booking") {
                 currentPaymentType = 'remaining';
                 setupPaymentPage(Math.ceil(globalFullPrice * 0.8));
                 document.getElementById('pay-label').innerHTML = "‡∏ä‡∏≥‡∏£‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (80%)";
                 showStep('step-payment');
            } else showModal('payment_choice', null, { price: globalFullPrice });
        } else alert("Error: " + res.message);
      }).catch(err => { document.getElementById('loading').style.display = 'none'; alert("Error: " + err.message); });
    }

    function setupPaymentPage(price) {
      if (globalConfig) updatePricingUI(globalConfig);
      document.getElementById('showPrice').innerText = (price || globalFullPrice).toLocaleString();
    }
    function updatePricingUI(data) {
      const paid = data.paidCount; const cfg = data.config;
      document.getElementById('price-super').innerText = cfg.priceSuper.toLocaleString() + ".-";
      document.getElementById('price-early').innerText = cfg.priceEarly.toLocaleString() + ".-";
      document.getElementById('price-normal').innerText = cfg.priceNormal.toLocaleString() + ".-";
      const tSuper = document.getElementById('tier-super'), tEarly = document.getElementById('tier-early'), tNormal = document.getElementById('tier-normal');
      [tSuper, tEarly, tNormal].forEach(e => e.className = 'tier-item future');
      if (paid < cfg.superLimit) { tSuper.className = 'tier-item active'; tSuper.querySelector('span:first-child').innerHTML += ` <span class="badge-stock">üî• ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${cfg.superLimit - paid} ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</span>`; }
      else if (paid < cfg.earlyLimit) { tSuper.className = 'tier-item sold-out'; tEarly.className = 'tier-item active'; tEarly.querySelector('span:first-child').innerHTML += ` <span class="badge-stock">üî• ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${cfg.earlyLimit - paid} ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</span>`; }
      else { tSuper.className = 'tier-item sold-out'; tEarly.className = 'tier-item sold-out'; tNormal.className = 'tier-item active'; }
    }

    function compressImage(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader(); reader.readAsDataURL(file);
        reader.onload = e => {
          const img = new Image(); img.src = e.target.result;
          img.onload = () => {
            const canvas = document.createElement('canvas'); const maxW = 500;
            let w = img.width, h = img.height; if(w>maxW){ h*=maxW/w; w=maxW; }
            canvas.width=w; canvas.height=h; canvas.getContext('2d').drawImage(img,0,0,w,h);
            resolve(canvas.toDataURL('image/jpeg', 0.4).split(',')[1]);
          }; img.onerror=reject;
        }; reader.onerror=reject;
      });
    }

    function previewFile() {
      const f = document.getElementById('slipFile').files[0];
      if(f) { const r = new FileReader(); r.onload = e => { document.getElementById('preview').src = e.target.result; document.getElementById('preview').style.display="block"; document.getElementById('btnConfirm').style.display="block"; }; r.readAsDataURL(f); }
    }

    async function uploadSlip() {
      const f = document.getElementById('slipFile').files[0]; if(!f) return alert("‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡πà‡∏≠‡∏ô");
      document.getElementById('btnConfirm').disabled = true; document.getElementById('loading').style.display='flex';
      try {
        if(!globalRowID) throw new Error("Session Expired");
        const base64 = await compressImage(f);
        const res = await fetch(WEB_APP_URL, { method: 'POST', body: JSON.stringify({ action: 'uploadSlip', rowid: globalRowID, base64: base64, amountType: currentPaymentType }) }).then(r=>r.json());
        document.getElementById('loading').style.display='none';
        if(res.status==='success') {
            document.querySelector('#step-success h2').innerText = res.newStatus==="Booking"?"‡∏à‡∏≠‡∏á‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!":"‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
            document.getElementById('success-msg').innerHTML = res.newStatus==="Booking"?"‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥‡πÅ‡∏•‡πâ‡∏ß":"‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß";
            showStep('step-success');
        } else { alert("Error: "+res.message); document.getElementById('btnConfirm').disabled=false; }
      } catch(e) { document.getElementById('loading').style.display='none'; alert("Error: "+e.message); document.getElementById('btnConfirm').disabled=false; }
    }
  </script>
</body>
</html>
